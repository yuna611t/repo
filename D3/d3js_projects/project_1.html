<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>D3.jsの勉強</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
<style>
svg { width: 380px; height: 240px; border: 1px solid black; }
.file { stroke: black; fill: #777; }
.name { font-size: 10pt; text-anchor: middle; }
</style>
    </head>
    <body>

<h1>ファイル階層を表示</h1>
<svg id="myGraph"></svg>

<script type="text/javascript">
// SVG要素
var svgEle = document.getElementById("myGraph");
var svgWidth = window.getComputedStyle(svgEle,null).getPropertyValue("width");
var svgHeight = window.getComputedStyle(svgEle,null).getPropertyValue("height");
svgWidth = parseFloat(svgWidth);
svgHeight = parseFloat(svgHeight);
// データセット
var dataSet = {
    name: "ルート",
    children: [
        { name: "Dir1", children: [
            { name: "ファイルA", value: 5000 },
            { name: "ファイルB", value: 3000 },
            { name: "Dir3", children: [
                { name: "ファイルC", value: 5000 },
                { name: "Dir4", children: [
                    { name: "ファイルD", value: 1000 },
                    { name: "ファイルE", value: 1500 }
                ]}
            ]}
        ]}
    ]
};
// ツリーマップレイアウト
var treemap = d3.layout.treemap()
    .size([svgWidth, svgHeight])
var tmap = d3.select("#myGraph")
    .selectAll("rect")
    .data(treemap.nodes(dataSet))
// 分割マップ領域を追加
tmap.enter()
    .append("rect")
    .attr("class", "file")
    .attr("x", function (d, i) {
        return d.x;
    })
    .attr("y", function (d, i) {
        return d.y;
    })
    .attr("width", function (d, i) {
        return d.dx;
    })
    .attr("height", function (d, i) {
        return d.dy;
    })
    .style("opacity", 0)
    .transition()
    .delay(function (d, i) {
        return d.depth * 500;
    })
    .style("opacity", function (d, i) {
        return d.depth / 10;
    })
// マップに文字を追加
tmap.enter()
    .append("text")
    .attr("class", "name")
    .attr("transform", function (d, i) {
        var deg = 0;
        if (d.dx < d.dy) {
            deg = -90;
        }
        return "translate("+ (d.x + d.dx/2) +", "+ (d.y+d.dy/2) +") rotate("+ deg +")";
    })
    .attr("dy", "0.35em")
    .text(function (d, i) {
        if ((d.depth == 0) || (d.children)) { // ルートか子ノードがあるの時は表示しない
            return null;
        }
        return d.name;
    })
    .style("opacity", 0)
    .transition()
    .delay(function (d, i) {
        return d.depth * 500;
    })
    .style("opacity", 1.0)
</script>
    </body>
</html>
