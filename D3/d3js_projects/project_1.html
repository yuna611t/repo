<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>SVG</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
<style>
svg { width: 320px; height: 240px; border: 1px solid black; }
.pie { fill: white; stroke: white;}
.total { font-size: 9pt; text-anchor: middle; }
.pieNum { font-size: 10pt; text-anchor: middle; }
</style>
    </head>
    <body>

<h1>円グラフに数値を表示</h1>
<svg id="myGraph"></svg>

<script type="text/javascript">
// SVG要素
var svgWidth = 320;   // SVG要素の横幅
var svgHeight = 240;  // SVG要素の高さ
// データセット
var dataSet = [50, 30, 12, 5, 3];
var color = d3.scale.category10();
// 円グラフの座業を計算するメソッド
var pie = d3.layout.pie()
            .value(function (d, i) { return d; }) // データセットを返す
var arc = d3.svg.arc()
            .innerRadius(30)    // 内径
            .outerRadius(100)  // 半径(外径)
// 円グラフを描画
var pieElements = d3.select("#myGraph")
                    .selectAll("g")
                    .data(pie(dataSet))
                    .enter()
                    .append("g")
                    .attr("transform", "translate("+ svgWidth/2 + ", " + svgHeight/2 +")")
// データの追加
pieElements
    .append("path")
    .attr("class", "pie")
    .style("fill", function (d, i) {
        return color(i);
    })
    .transition()
    .duration(200)
    .delay(function (d, i) {
        return i * 200;
    })
    .ease("linear") // 直線的な動きに変更する
    .attrTween("d", function (d, i) {
        var interpolate = d3.interpolate(
            { startAngle: d.startAngle, endAngle: d.startAngle }, // 各部分の開始角度
            { startAngle: d.startAngle, endAngle: d.endAngle }    // 各部分の終了角度
        );
        return function (t) {
            return arc(interpolate(t));
        }
    })
// 合計の数と文字の表示
var textElements = d3.select("#myGraph")
    .append("text")
    .attr("class", "total")
    .attr("transform", "translate("+ svgWidth/2 + ", "+ (svgHeight/2 + 5) +")")
    .text("合計:" + d3.sum(dataSet))
// 数値を円弧の中に表示
pieElements.append("text")
    .attr("class", "piNum")
    .attr("transform", function (d, i) {
        return "translate("+ arc.centroid(d) +")";
    })
    .text(function (d, i) {
        return d.value;
    })

</script>
    </body>
</html>
