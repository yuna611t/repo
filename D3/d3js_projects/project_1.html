<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>D3.jsの勉強</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
<style>
svg { width: 380px; height: 240px; border: 1px solid black; }
.block { stroke: black; fill: #ddd; }
.name { font-size: 18pt; text-anchor: middle; }
</style>
    </head>
    <body>

<h1>ツリーレイアウトを表示</h1>
<svg id="myGraph"></svg>

<script type="text/javascript">
// SVG要素
var svgEle = document.getElementById("myGraph");
var svgWidth = window.getComputedStyle(svgEle,null).getPropertyValue("width");
var svgHeight = window.getComputedStyle(svgEle,null).getPropertyValue("height");
svgWidth = parseFloat(svgWidth);
svgHeight = parseFloat(svgHeight);
// データセット
var dataSet = {
    children: [
        { value: 100 },
        {
            children: [
                { value: 50 },
                { children: [
                    { value: 30 },
                    { value: 20 },
                    { value: 10 }
                ]}
            ]
        }
    ]
};
// ツリーマップレイアウト
var treemap = d3.layout.treemap()
    .size([svgWidth, svgHeight])
var tmap = d3.select("#myGraph")
    .selectAll("rect")
    .data(treemap.nodes(dataSet))
// 分割マップ領域を追加
tmap.enter()
    .append("rect")
    .attr("class", "block")
    .attr("x", function (d, i) {
        console.log("x: ", d);
        return d.x;
    })
    .attr("y", function (d, i) {
        return d.y;
    })
    .attr("width", function (d, i) {
        return d.dx;
    })
    .attr("height", function (d, i) {
        return d.dy;
    })
// マップに文字を追加
tmap.enter()
    .append("text")
    .attr("class", "name")
    .attr("transform", function (d, i) {
        return "translate("+ (d.x + d.dx/2) +", "+ (d.y+d.dy/2) +")";
    })
    .attr("dy", "0.35em")
    .text(function (d, i) {
        if ((d.depth == 0) || (d.children)) { // ルートか子ノードがあるの時は表示しない
            return null;
        }
        return d.value;
    })
</script>
    </body>
</html>
