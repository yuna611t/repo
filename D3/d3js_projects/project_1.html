<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>D3.jsの勉強</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
<style>
svg { width: 380px; height: 320px; border: 1px solid black; }
circle { stroke: none; opacity: 0.25;}
text { font-size: 10pt; text-anchor: middle; fill: black; opacity: 0; }
</style>
    </head>
    <body>

<h1>人口をパックレイアウトを表示</h1>
<svg id="myGraph"></svg>

<script type="text/javascript">
// SVG要素
var svgEle = document.getElementById("myGraph");
var svgWidth = window.getComputedStyle(svgEle,null).getPropertyValue("width");
var svgHeight = window.getComputedStyle(svgEle,null).getPropertyValue("height");
// データセット
var dataSet = {
    name: "全国", value: 128057352,
    children: [
        { name: "東京都", value: 12159388 },
        { name: "大阪府", value: 8865245  },
        { name: "愛知県", value: 7410719  },
        { name: "長野県", value: 2152449,
            children: [
                { name: "長野市", value: 381511 },
                { name: "松本市", value: 243037 },
                { name: "塩尻市", value: 67670  }
            ]
        }
    ]
};
// カラーの準備
var color = d3.scale.category10();
// パックレイアウト
var bubble = d3.layout.pack()
    .size([320, 320])
// パックレイアウトで使用するグループ生成
var pack = d3.select("#myGraph")
    .selectAll("g")
    .data(bubble.nodes(dataSet))
    .enter()
    .append("g")
    .attr("transform", function (d, i) {
        return "translate("+ d.x + ", "+ d.y +")"
    })
// 円を生成
pack.append("circle")
    .attr("r", 0)
    .transition()
    .duration(function (d, i) {
        return d.depth * 1000 + 500;
    })
    .attr("r", function (d) {
        return d.r;
    })
    .style("fill", function (d, i) {
        return color(i);
    })
// 円に表示する文字を生成
pack.append("text")
    .style("opacity", 0)
    .transition()
    .duration(3000)
    .style("opacity", 1.0)
    .text(function (d, i) {
        if (d.depth == 1) {
            return d.name;
        }
        return null;
    })

</script>
    </body>
</html>
