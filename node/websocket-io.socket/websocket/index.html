<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>WebSocketTest</title>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
        <script type="text/javascript">
            var host = window.document.location.host.replace(/:.*/, '');
            var ws = new WebSocket('ws://' + host + ':3001');

            ws.onopen = function(e) {
                console.log('onoepn: ' + e);
            }
            ws.onmessage = function(data) {
                console.log('onmessage: ' + data.data);
                var el = '<div class="message">' + data.data + '</div>';
                $(el).appendTo($('.msg-list'));
            }
            ws.onclose = function() {
                console.log('onclose');
            }
            ws.onerror = function() {
                console.log('onerror');
            }
        </script>

        <script type="text/javascript">
            $(document).ready(function(){
                var $node = $('.message-box'),
                    $text = $node.find('input[type=text]');
                $node.on('click', 'input[type=button]', function(e) {
                    e.preventDefault();
                    var msg = $text.val(); $text.val("");
                    // socket send
                    ws.send(msg);
                });
            });
        </script>
    </head>
    <body>
        This is Websocket Page
        <div class="message-box">
            <input type="text">
            <input type="button" value="送信">
        </div>
        <div class="msg-list"></div>


    </body>
</html>
